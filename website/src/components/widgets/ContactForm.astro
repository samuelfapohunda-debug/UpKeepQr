---
import type { HTMLAttributes } from 'astro/types';

export interface Props extends HTMLAttributes<'section'> {
  title?: string;
  subtitle?: string;
  tagline?: string;
  sent?: boolean;
  error?: boolean;
}

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline,
  sent = false,
  error = false,
  ...rest
} = Astro.props;
---

<section class="bg-white dark:bg-slate-900" {...rest}>
  <div class="mx-auto max-w-7xl px-4 py-16 sm:px-6 lg:px-8 lg:py-20">
    <div class="mx-auto max-w-3xl">
      {(title || subtitle || tagline) && (
        <div class="mb-8 text-center md:mx-auto md:mb-12">
          {tagline && (
            <p
              class="text-base text-secondary-600 dark:text-secondary-400 font-semibold tracking-wide uppercase"
              set:html={tagline}
            />
          )}
          {title && (
            <h1
              class="text-4xl md:text-5xl font-bold leading-tighter tracking-tighter mb-4 font-heading text-primary-900 dark:text-slate-200"
              set:html={title}
            />
          )}
          {subtitle && (
            <p
              class="max-w-3xl mx-auto sm:text-center text-xl text-muted dark:text-slate-400"
              set:html={subtitle}
            />
          )}
        </div>
      )}

      <!-- Success Message -->
      {sent && (
        <div 
          class="mb-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"
          role="status"
          data-testid="alert-success"
        >
          <p class="text-green-800 dark:text-green-300">
            ‚úÖ Thanks! Your message was sent. We'll get back to you shortly.
          </p>
        </div>
      )}

      <!-- Error Message -->
      {error && (
        <div 
          class="mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"
          role="alert"
          data-testid="alert-error"
        >
          <p class="text-red-800 dark:text-red-300">
            ‚ùå Sorry‚Äîsomething went wrong. Please try again or email support@upkeepqr.com.
          </p>
        </div>
      )}

      <!-- Contact Form -->
      <form 
        class="space-y-6 bg-slate-50 dark:bg-slate-800/50 p-8 rounded-lg border border-slate-200 dark:border-slate-700" 
        method="post" 
        action="/api/contact"
        data-testid="form-contact"
      >
        <!-- Honeypot (spam trap) -->
        <input 
          type="text" 
          name="website" 
          tabindex="-1" 
          autocomplete="off" 
          class="hidden" 
          aria-hidden="true" 
        />

        <!-- Full Name -->
        <div>
          <label 
            for="name" 
            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
          >
            Full name *
          </label>
          <input 
            id="name" 
            name="name" 
            type="text"
            required 
            autocomplete="name"
            data-testid="input-name"
            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 transition-colors"
          />
        </div>

        <!-- Email and Phone -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label 
              for="email" 
              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
            >
              Email *
            </label>
            <input 
              id="email" 
              name="email" 
              type="email"
              required 
              autocomplete="email"
              data-testid="input-email"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 transition-colors"
            />
          </div>
          <div>
            <label 
              for="phone" 
              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
            >
              Phone (optional)
            </label>
            <input 
              id="phone" 
              name="phone" 
              type="tel"
              autocomplete="tel"
              data-testid="input-phone"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 transition-colors"
            />
          </div>
        </div>

        <!-- Subject and ZIP -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label 
              for="topic" 
              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
            >
              Subject *
            </label>
            <select 
              id="topic" 
              name="topic" 
              required
              data-testid="select-topic"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 transition-colors"
            >
              <option value="">Choose‚Ä¶</option>
              <option value="Order & Pricing">Order & Pricing</option>
              <option value="Product Question">Product Question</option>
              <option value="Partnership / Bulk">Partnership / Bulk</option>
              <option value="Support">Support</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label 
              for="zip" 
              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
            >
              ZIP (optional)
            </label>
            <input 
              id="zip" 
              name="zip" 
              type="text"
              inputmode="numeric" 
              pattern="[0-9]*"
              data-testid="input-zip"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 transition-colors"
            />
          </div>
        </div>

        <!-- Message -->
        <div>
          <label 
            for="message" 
            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
          >
            Message *
          </label>
          <textarea 
            id="message" 
            name="message" 
            rows="6" 
            required 
            placeholder="How can we help?"
            data-testid="textarea-message"
            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 transition-colors resize-vertical"
          ></textarea>
        </div>

        <!-- Consent Checkbox -->
        <div class="flex items-start gap-3">
          <input 
            id="consent" 
            name="consent" 
            type="checkbox" 
            required 
            data-testid="checkbox-consent"
            class="mt-1 h-4 w-4 text-accent-500 focus:ring-accent-500 border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-800"
          />
          <label 
            for="consent" 
            class="text-sm text-slate-600 dark:text-slate-400"
          >
            I agree to be contacted about my enquiry. *
          </label>
        </div>

        <!-- Submit Button -->
        <div class="pt-4">
          <button 
            type="submit" 
            data-testid="button-submit"
            class="w-full sm:w-auto btn btn-primary text-lg px-8 py-3 shadow-md hover:shadow-lg transition-shadow"
          >
            Send message
          </button>
        </div>
      </form>

      <!-- Footer Note -->
      <p class="text-sm text-slate-500 dark:text-slate-400 mt-6 text-center">
        üîí We use secure email delivery. You'll also get a copy of your request.
      </p>
    </div>
  </div>
</section>