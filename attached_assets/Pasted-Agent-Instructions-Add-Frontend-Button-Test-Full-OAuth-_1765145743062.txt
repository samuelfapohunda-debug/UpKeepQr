Agent Instructions: Add Frontend Button & Test Full OAuth Flow

Objective: Enable end-to-end Google Calendar sync from the admin frontend so OAuth tokens are stored and tasks can be synced.

1. Add a “Connect & Sync Calendar” button to the admin page

Place it somewhere visible on the admin interface for household management.

Example React/JSX snippet:

<button
  onClick={async () => {
    try {
      const res = await fetch('https://upkeepqr-backend.onrender.com/api/calendar/sync', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ householdId: 'test-household-calendar' })
      });

      const data = await res.json();
      alert(`Calendar sync: ${data.message}`);
    } catch (err) {
      console.error('Sync error:', err);
      alert('Failed to sync calendar');
    }
  }}
  style={{ padding: '10px 20px', backgroundColor: '#4CAF50', color: 'white', borderRadius: '5px', cursor: 'pointer' }}
>
Connect & Sync Google Calendar
</button>


Notes:

Replace householdId with dynamic household IDs if needed.

Button styling is optional but gives visual clarity.

Clicking this triggers the backend POST /sync endpoint, initiating OAuth if no token exists.

2. Verify the OAuth flow works

Click the new button in a staging/admin environment.

Google consent screen should appear.

After granting permission, the browser redirects to:

https://upkeepqr-backend.onrender.com/api/calendar/google/callback


Backend stores the access/refresh tokens and completes the calendar sync.

Render logs should confirm:

Starting calendar sync for household: <householdId>
Synced X tasks to calendar

3. Test calendar sync

After OAuth completes:

curl -X POST "https://upkeepqr-backend.onrender.com/api/calendar/sync" \
     -H "Content-Type: application/json" \
     -d '{"householdId":"test-household-calendar"}'


Expect:

{"success":true,"created":3,"skipped":0,"message":"Synced 3 tasks to calendar"}


Confirms tasks are being pushed to Google Calendar.

4. Cleanup & Production Prep

Remove temporary GET /sync-test endpoint once flow verified.

Push frontend and backend changes to production.

Ensure only POST /sync is used for production triggers.