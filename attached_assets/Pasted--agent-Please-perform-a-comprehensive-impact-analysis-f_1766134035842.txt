@agent Please perform a comprehensive impact analysis for consolidating Firebase and PostgreSQL into a single PostgreSQL database.

CONTEXT:
UpKeepQr currently uses TWO databases:
1. **PostgreSQL (Neon)** - Primary database with 22+ tables
2. **Firebase Firestore** - Secondary database with 6 collections

We're planning to migrate all Firebase data to PostgreSQL and remove Firebase completely.

OBJECTIVE:
Analyze the full impact of this consolidation before proceeding with Phase 2 & 3 of the migration.

ANALYSIS REQUIRED:

## 1. CODE IMPACT ANALYSIS

**Files Using Firebase:**
```bash
# Find all Firebase usage
grep -r "firebase\|adminDb\|firestore" server --include="*.ts" --include="*.js"

# Count Firebase dependencies
grep -r "from.*firebase\|import.*firebase" server --include="*.ts" | wc -l

# List all files that will need changes
grep -rl "adminDb\." server/src --include="*.ts"
```

**Expected Changes:**
- How many files need modification?
- Which API endpoints will be affected?
- Which background jobs/cron tasks use Firebase?

## 2. DATA MIGRATION IMPACT

**Current Data Assessment:**
```bash
# Check what PostgreSQL tables already exist
grep "pgTable" shared/schema.ts | grep -o '"[^"]*"' | sort

# Check Firebase collections used
grep "collection(" server/storage.ts | grep -o "'[^']*'" | sort -u
```

**Questions to Answer:**
- Which Firebase collections have PostgreSQL equivalents?
  * magnets → order_magnet_items?
  * magnetBatches → order_magnet_batches?
  * households → households? (duplicate data?)
  * agents → ??? (missing table)
  * leads → ??? (missing table)
  * tasks → home_maintenance_tasks?

- What data is ONLY in Firebase?
- What data is DUPLICATED (exists in both)?
- What's the migration strategy for each collection?

## 3. FUNCTIONAL IMPACT

**Features Using Firebase:**
Based on `server/storage.ts` analysis, document which features will be affected:

1. **QR Magnet System:**
   - Magnet token generation
   - Batch tracking
   - Activation flow
   - **Impact:** HIGH/MEDIUM/LOW

2. **Agent/Sales System:**
   - Agent profiles
   - Commission tracking?
   - **Impact:** HIGH/MEDIUM/LOW

3. **Lead Management:**
   - Lead capture
   - Lead tracking
   - **Impact:** HIGH/MEDIUM/LOW

4. **Task System:**
   - Task creation
   - Task assignments
   - Task completion
   - **Impact:** HIGH/MEDIUM/LOW

5. **Household Management:**
   - Household profiles (DUPLICATE in both DBs!)
   - **Impact:** CRITICAL - risk of data inconsistency

## 4. RISK ASSESSMENT

**Data Loss Risks:**
- Which collections have no PostgreSQL backup?
- Which collections might have data only in Firebase?
- What's the rollback plan if migration fails?

**Performance Impact:**
- Will PostgreSQL handle the additional load?
- Are there query patterns that worked well in Firestore but might be slow in PostgreSQL?
- Index requirements?

**Downtime Requirements:**
- Can migration happen with zero downtime?
- Which features need to be frozen during migration?

## 5. TECHNICAL DEBT REDUCTION

**Benefits of Consolidation:**
- Single database = simpler architecture
- Better ACID transactions
- Easier backup/restore
- Lower costs (remove Firebase subscription)
- Better relational queries

**Estimated Savings:**
- Monthly Firebase costs: $?
- Development complexity reduction: ?
- Maintenance time saved: ?

## 6. MIGRATION COMPLEXITY MATRIX

For each Firebase collection, assess:

| Collection | PostgreSQL Table | Data Volume | Complexity | Risk | Priority |
|------------|-----------------|-------------|------------|------|----------|
| magnets | order_magnet_items | ? records | LOW/MED/HIGH | LOW/MED/HIGH | 1-5 |
| magnetBatches | order_magnet_batches | ? | ? | ? | ? |
| households | households | ? | ? | CRITICAL | ? |
| agents | (missing) | ? | ? | ? | ? |
| leads | (missing) | ? | ? | ? | ? |
| tasks | home_maintenance_tasks | ? | ? | ? | ? |
| schedules | (missing) | ? | ? | ? | ? |
| taskCompletions | (missing) | ? | ? | ? | ? |
| events | audit_events | ? | ? | ? | ? |
| auditLogs | order_magnet_audit_events | ? | ? | ? | ? |
| reminderQueue | (missing) | ? | ? | ? | ? |

## 7. STEP-BY-STEP MIGRATION PLAN

Based on the analysis, create a detailed plan:

**Phase 2A: Create Missing Tables**
- [ ] Create agents table schema
- [ ] Create leads table (beyond just schema)
- [ ] Create schedules table
- [ ] Create task_completions table
- [ ] Create reminder_queue table

**Phase 2B: Data Migration (Low Risk First)**
- [ ] Collection 1: ...
- [ ] Collection 2: ...
- [ ] Collection 3: ...

**Phase 2C: Code Migration**
- [ ] Update storage.ts functions
- [ ] Update API routes
- [ ] Update background jobs

**Phase 3: Firebase Removal**
- [ ] Remove Firebase SDK
- [ ] Remove environment variables
- [ ] Update deployment configs
- [ ] Cancel Firebase subscription

## DELIVERABLE

Create a comprehensive report: `docs/FIREBASE_MIGRATION_IMPACT_ANALYSIS.md`

Include:
1. Executive summary (risks, benefits, timeline)
2. Detailed findings for each section above
3. Go/No-Go recommendation
4. Mitigation strategies for identified risks
5. Rollback procedures
6. Testing requirements
7. Estimated effort (hours/days)

Start the analysis now and provide the complete impact assessment.