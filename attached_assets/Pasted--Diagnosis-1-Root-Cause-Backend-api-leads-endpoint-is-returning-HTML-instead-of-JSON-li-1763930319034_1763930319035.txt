## Diagnosis

**1. Root Cause:** Backend `/api/leads` endpoint is returning HTML instead of JSON (likely 500 error or missing route).

**2. Immediate Fix:**
```bash
# Check if leads route exists
grep -r "'/leads'" server/

# Check server logs when submitting form
npm run dev
# Then submit form and watch console
```

**3. Why It Happened:** 
- Leads API endpoint either doesn't exist, crashed, or has syntax error
- Server returning HTML error page instead of JSON response
- Frontend trying to parse HTML as JSON → "Unexpected token '<'"

**4. Prevention (Replit Agent Fix):**

**Check if route exists first:**
```bash
grep -r "leads" server/src/routes/
```

**If missing, create:** `server/src/routes/leads.ts`

```typescript
import { Router } from 'express';
import sgMail from '@sendgrid/mail';

const router = Router();
sgMail.setApiKey(process.env.SENDGRID_API_KEY!);

router.post('/leads', async (req, res) => {
  try {
    const { 
      fullName, 
      phoneNumber, 
      email, 
      streetAddress, 
      apt, 
      city, 
      state, 
      zipcode,
      serviceType,
      urgency,
      serviceDescription,
      preferredTime,
      photos 
    } = req.body;

    // Validate required fields
    if (!fullName || !phoneNumber || !email || !streetAddress || !city || !state || !zipcode || !serviceType || !urgency) {
      return res.status(400).json({ 
        error: 'Missing required fields' 
      });
    }

    // Send email notification
    await sgMail.send({
      to: 'support@upkeepqr.com',
      from: 'noreply@upkeepqr.com',
      subject: `New Service Request: ${serviceType} - ${urgency}`,
      html: `
        <h2>New Professional Service Request</h2>
        <h3>Contact Information</h3>
        <p><strong>Name:</strong> ${fullName}</p>
        <p><strong>Phone:</strong> ${phoneNumber}</p>
        <p><strong>Email:</strong> ${email}</p>
        
        <h3>Service Address</h3>
        <p>${streetAddress}${apt ? ', ' + apt : ''}</p>
        <p>${city}, ${state} ${zipcode}</p>
        
        <h3>Service Details</h3>
        <p><strong>Type:</strong> ${serviceType}</p>
        <p><strong>Urgency:</strong> ${urgency}</p>
        <p><strong>Description:</strong></p>
        <p>${serviceDescription || 'Not provided'}</p>
        <p><strong>Preferred Time:</strong> ${preferredTime || 'Not specified'}</p>
      `
    });

    res.json({ 
      success: true, 
      message: 'Service request submitted successfully' 
    });

  } catch (error) {
    console.error('Leads submission error:', error);
    res.status(500).json({ 
      error: 'Failed to submit request' 
    });
  }
});

export default router;
```

**Register in `server/index.ts`:**
```typescript
import leadsRoutes from './src/routes/leads';
app.use('/api', leadsRoutes);
console.log('✅ Leads routes registered at /api/leads');
```

**Test:**
```bash
curl -X POST http://localhost:5000/api/leads \
  -H "Content-Type: application/json" \
  -d '{"fullName":"Test","phoneNumber":"123","email":"test@test.com","streetAddress":"123 St","city":"City","state":"GA","zipcode":"30000","serviceType":"Plumbing","urgency":"Emergency"}'
```

Should return JSON, not HTML.