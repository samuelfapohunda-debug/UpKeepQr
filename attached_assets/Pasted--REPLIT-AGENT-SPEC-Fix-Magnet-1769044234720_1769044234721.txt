â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ¤– REPLIT AGENT SPEC: Fix Magnet Orders Dashboard          â•‘
â•‘  API Returns HTML - Need JSON Endpoint                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TASK: Fix magnet orders dashboard failing to load
ERROR: "Unexpected token '<', "<!DOCTYPE "... is not valid JSON"
ROOT CAUSE: API endpoint doesn't exist or returns HTML instead of JSON
PRIORITY: High - Admin cannot view orders

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ IMPLEMENTATION REQUIREMENTS

Create backend API endpoint that returns JSON magnet orders data
Fix frontend to properly call API with authentication
Admin should see all magnet orders with metrics and filters

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ STEP-BY-STEP IMPLEMENTATION

Step 1: Create Backend API Endpoint (30 min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
File: server/src/routes/admin/magnets.ts

Create new file with this content:

```typescript
import { Router } from 'express';
import { requireAdmin } from '../../middleware/adminAuth';
import { db } from '../../db';

const router = Router();

// GET /api/admin/magnets - Get all magnet orders with filters
router.get('/', requireAdmin, async (req, res) => {
  try {
    const { 
      search, 
      sku, 
      zipCode, 
      dateFrom, 
      dateTo, 
      status,
      page = 1,
      limit = 50
    } = req.query;
    
    // Build base query
    let query = `
      SELECT 
        mo.id,
        mo.order_id,
        mo.household_id,
        mo.product_sku,
        mo.quantity,
        mo.price,
        mo.status,
        mo.stripe_session_id,
        mo.stripe_payment_intent_id,
        mo.created_at,
        mo.updated_at,
        h.address,
        h.city,
        h.state,
        h.zip_code,
        COUNT(*) OVER() as total_count
      FROM magnet_orders mo
      LEFT JOIN households h ON mo.household_id = h.id
      WHERE 1=1
    `;
    
    const params: any[] = [];
    let paramIndex = 1;
    
    // Apply filters
    if (search) {
      params.push(`%${search}%`);
      query += ` AND (
        mo.order_id ILIKE $${paramIndex} 
        OR h.address ILIKE $${paramIndex}
        OR h.city ILIKE $${paramIndex}
      )`;
      paramIndex++;
    }
    
    if (sku) {
      params.push(sku);
      query += ` AND mo.product_sku = $${paramIndex}`;
      paramIndex++;
    }
    
    if (zipCode) {
      params.push(zipCode);
      query += ` AND h.zip_code = $${paramIndex}`;
      paramIndex++;
    }
    
    if (dateFrom) {
      params.push(dateFrom);
      query += ` AND mo.created_at >= $${paramIndex}`;
      paramIndex++;
    }
    
    if (dateTo) {
      params.push(dateTo);
      query += ` AND mo.created_at <= $${paramIndex}`;
      paramIndex++;
    }
    
    if (status) {
      params.push(status);
      query += ` AND mo.status = $${paramIndex}`;
      paramIndex++;
    }
    
    // Add ordering
    query += ` ORDER BY mo.created_at DESC`;
    
    // Add pagination
    const offset = (Number(page) - 1) * Number(limit);
    params.push(Number(limit), offset);
    query += ` LIMIT $${paramIndex} OFFSET $${paramIndex + 1}`;
    
    // Execute query
    const ordersResult = await db.query(query, params);
    
    // Get metrics
    const metricsResult = await db.query(`
      SELECT 
        COUNT(*) as total_orders,
        COUNT(*) FILTER (WHERE status = 'new') as pending_orders,
        COUNT(*) FILTER (WHERE status = 'paid') as paid_orders,
        COUNT(*) FILTER (WHERE status = 'in_production') as in_production_orders,
        COUNT(*) FILTER (WHERE status = 'shipped') as shipped_orders,
        COUNT(*) FILTER (WHERE status = 'delivered') as delivered_orders,
        COALESCE(SUM(price), 0) as total_revenue
      FROM magnet_orders
    `);
    
    console.log(`[Admin Magnets] Fetched ${ordersResult.rows.length} orders`);
    
    return res.json({
      success: true,
      orders: ordersResult.rows,
      metrics: metricsResult.rows[0],
      pagination: {
        page: Number(page),
        limit: Number(limit),
        total: ordersResult.rows[0]?.total_count || 0
      }
    });
    
  } catch (err) {
    console.error('[Admin Magnets] Failed to fetch orders:', err);
    return res.status(500).json({
      success: false,
      error: 'Failed to fetch magnet orders',
      message: process.env.NODE_ENV === 'development' ? err.message : undefined
    });
  }
});

// GET /api/admin/magnets/:id - Get single order details
router.get('/:id', requireAdmin, async (req, res) => {
  try {
    const { id } = req.params;
    
    const result = await db.query(`
      SELECT 
        mo.*,
        h.address,
        h.city,
        h.state,
        h.zip_code
      FROM magnet_orders mo
      LEFT JOIN households h ON mo.household_id = h.id
      WHERE mo.id = $1
    `, [id]);
    
    if (result.rows.length === 0) {
      return res.status(404).json({
        success: false,
        error: 'Order not found'
      });
    }
    
    return res.json({
      success: true,
      order: result.rows[0]
    });
    
  } catch (err) {
    console.error('[Admin Magnets] Failed to fetch order:', err);
    return res.status(500).json({
      success: false,
      error: 'Failed to fetch order'
    });
  }
});

// PATCH /api/admin/magnets/:id - Update order status
router.patch('/:id', requireAdmin, async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    
    // Validate status
    const validStatuses = [
      'new', 'paid', 'in_production', 
      'shipped', 'delivered', 'activated', 
      'canceled', 'refunded'
    ];
    
    if (!status || !validStatuses.includes(status)) {
      return res.status(400).json({
        success: false,
        error: 'Invalid status. Valid statuses: ' + validStatuses.join(', ')
      });
    }
    
    const result = await db.query(`
      UPDATE magnet_orders
      SET 
        status = $1, 
        updated_at = NOW()
      WHERE id = $2
      RETURNING *
    `, [status, id]);
    
    if (result.rows.length === 0) {
      return res.status(404).json({
        success: false,
        error: 'Order not found'
      });
    }
    
    console.log(`[Admin Magnets] Order ${id} status updated to ${status} by admin ${req.user?.email}`);
    
    return res.json({
      success: true,
      order: result.rows[0]
    });
    
  } catch (err) {
    console.error('[Admin Magnets] Failed to update order:', err);
    return res.status(500).json({
      success: false,
      error: 'Failed to update order'
    });
  }
});

export default router;
```

Step 2: Register Route in Main Router (5 min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
File: server/src/routes/index.ts

Find where admin routes are registered and add:

```typescript
import adminMagnetRoutes from './admin/magnets';

// Add this line with other admin route registrations
router.use('/admin/magnets', requireAdmin, adminMagnetRoutes);
```

If there's no existing admin routes section, add it like:

```typescript
// Admin routes (protected by requireAdmin middleware)
import { requireAdmin } from '../middleware/adminAuth';
import adminMagnetRoutes from './admin/magnets';

router.use('/admin/magnets', requireAdmin, adminMagnetRoutes);
```

Step 3: Fix Frontend API Call (15 min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
File: Find the MagnetOrders component (likely client/src/pages/admin/MagnetOrders.tsx or similar)

Update the fetchOrders function:

```typescript
const fetchOrders = async () => {
  setLoading(true);
  setError('');
  
  try {
    // Build query string from filters
    const params = new URLSearchParams();
    if (filters.search) params.append('search', filters.search);
    if (filters.sku) params.append('sku', filters.sku);
    if (filters.zipCode) params.append('zipCode', filters.zipCode);
    if (filters.dateFrom) params.append('dateFrom', filters.dateFrom);
    if (filters.dateTo) params.append('dateTo', filters.dateTo);
    if (filters.status) params.append('status', filters.status);
    
    const queryString = params.toString();
    const url = `/api/admin/magnets${queryString ? `?${queryString}` : ''}`;
    
    console.log('[MagnetOrders] Fetching from:', url);
    
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`,
        'Content-Type': 'application/json'
      },
      credentials: 'include'
    });
    
    console.log('[MagnetOrders] Response status:', response.status);
    
    // Handle auth errors
    if (response.status === 401 || response.status === 403) {
      console.error('[MagnetOrders] Authentication failed, redirecting to login');
      window.location.href = '/admin/login';
      return;
    }
    
    // Handle other HTTP errors
    if (!response.ok) {
      const errorText = await response.text();
      console.error('[MagnetOrders] HTTP error:', response.status, errorText);
      throw new Error(`HTTP ${response.status}: ${errorText}`);
    }
    
    // Verify content type
    const contentType = response.headers.get('content-type');
    if (!contentType || !contentType.includes('application/json')) {
      const text = await response.text();
      console.error('[MagnetOrders] Non-JSON response:', text.substring(0, 200));
      throw new Error('Server returned non-JSON response (HTML error page)');
    }
    
    // Parse JSON
    const data = await response.json();
    console.log('[MagnetOrders] Received data:', { 
      success: data.success, 
      ordersCount: data.orders?.length,
      metrics: data.metrics 
    });
    
    if (data.success) {
      setOrders(data.orders || []);
      setMetrics(data.metrics);
      setPagination(data.pagination);
    } else {
      throw new Error(data.error || 'Failed to fetch orders');
    }
    
  } catch (err) {
    console.error('[MagnetOrders] Failed to fetch orders:', err);
    setError(err.message || 'Failed to load orders. Check browser console for details.');
  } finally {
    setLoading(false);
  }
};
```

Step 4: Verify requireAdmin Middleware Exists (5 min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Check that file exists: server/src/middleware/adminAuth.ts

If it doesn't exist, the middleware should already exist from previous admin auth implementation.

If requireAdmin middleware is missing, create it:

```typescript
// server/src/middleware/adminAuth.ts
import { Request, Response, NextFunction } from 'express';
import jwt from 'jsonwebtoken';

export const requireAdmin = (req: Request, res: Response, next: NextFunction) => {
  try {
    // Check for JWT token in Authorization header
    const authHeader = req.headers.authorization;
    
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
      return res.status(401).json({
        success: false,
        error: 'No authorization token provided'
      });
    }
    
    const token = authHeader.substring(7); // Remove 'Bearer ' prefix
    
    // Verify token
    const decoded = jwt.verify(token, process.env.JWT_SECRET!) as any;
    
    // Check if user is admin
    if (decoded.role !== 'admin') {
      return res.status(403).json({
        success: false,
        error: 'Admin access required'
      });
    }
    
    // Attach user to request
    req.user = decoded;
    
    next();
  } catch (err) {
    console.error('[requireAdmin] Authentication failed:', err);
    return res.status(401).json({
      success: false,
      error: 'Invalid or expired token'
    });
  }
};
```

Step 5: Test the Fix (10 min)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Restart server (if needed)
2. Login as admin
3. Navigate to /admin/magnets
4. Open DevTools â†’ Network tab
5. Refresh page
6. Check:
   â–¡ API request to /api/admin/magnets appears
   â–¡ Status code is 200 (not 404, 401, or 500)
   â–¡ Response type is application/json (not text/html)
   â–¡ Response contains orders array and metrics object
   â–¡ Dashboard displays orders
   â–¡ No "Unexpected token" error

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ§ª TESTING CHECKLIST

After Implementation:

Backend Testing:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Route registered: Check server logs on startup
â–¡ Endpoint exists: GET /api/admin/magnets returns 200
â–¡ Returns JSON: Content-Type: application/json
â–¡ Requires auth: Returns 401 without token
â–¡ Requires admin: Returns 403 for non-admin
â–¡ Filters work: Query params filter results
â–¡ Metrics correct: Aggregates show right counts

Frontend Testing:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Dashboard loads: No "Failed to load orders" error
â–¡ Metrics display: Shows total, pending, shipped, revenue
â–¡ Orders table: Displays order list (or "No orders found")
â–¡ Filters work: Search, status, date filters apply
â–¡ No console errors: No "Unexpected token" errors
â–¡ Auth works: Redirects to login if token expired

Integration Testing:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Login â†’ Navigate to magnets â†’ See orders
â–¡ Apply filters â†’ Orders update
â–¡ Click order â†’ View order details
â–¡ Update status â†’ Order status changes
â–¡ Logout â†’ Cannot access /admin/magnets

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ EXPECTED API RESPONSE

When working correctly, GET /api/admin/magnets should return:

```json
{
  "success": true,
  "orders": [
    {
      "id": "uuid-here",
      "order_id": "101-2025",
      "household_id": "uuid-here",
      "product_sku": "QR-MAGNET-001",
      "quantity": 1,
      "price": "49.99",
      "status": "new",
      "stripe_session_id": "cs_...",
      "stripe_payment_intent_id": "pi_...",
      "created_at": "2026-01-20T12:00:00Z",
      "updated_at": "2026-01-20T12:00:00Z",
      "address": "123 Main St",
      "city": "Atlanta",
      "state": "GA",
      "zip_code": "30301",
      "total_count": "171"
    }
    // ... more orders
  ],
  "metrics": {
    "total_orders": "171",
    "pending_orders": "5",
    "paid_orders": "10",
    "in_production_orders": "20",
    "shipped_orders": "130",
    "delivered_orders": "6",
    "total_revenue": "8549.29"
  },
  "pagination": {
    "page": 1,
    "limit": 50,
    "total": 171
  }
}
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš¨ COMMON ISSUES & FIXES

Issue 1: "Cannot find module './admin/magnets'"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cause: File not created or wrong path
Fix: Ensure server/src/routes/admin/magnets.ts exists
Check import path matches file location

Issue 2: Still getting "Unexpected token '<'"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cause: Route not registered or wrong URL
Fix: Verify route registered in server/src/routes/index.ts
Check frontend calls /api/admin/magnets (not /admin/magnets)

Issue 3: 401 Unauthorized
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cause: Missing or invalid JWT token
Fix: Ensure Authorization header sent with Bearer token
Check localStorage.getItem('adminToken') returns valid token

Issue 4: 403 Forbidden
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cause: User is not admin
Fix: Login with admin credentials
Verify JWT token has role: 'admin'

Issue 5: Database error "relation does not exist"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cause: magnet_orders table doesn't exist
Fix: Run database migration to create table
Check table name spelling (magnet_orders vs magnets)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š DATABASE SCHEMA REFERENCE

Expected magnet_orders table structure:

```sql
CREATE TABLE magnet_orders (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  order_id VARCHAR(255) UNIQUE NOT NULL,
  household_id UUID REFERENCES households(id),
  product_sku VARCHAR(255),
  quantity INTEGER DEFAULT 1,
  price DECIMAL(10, 2),
  status VARCHAR(50) DEFAULT 'new',
  stripe_session_id VARCHAR(255),
  stripe_payment_intent_id VARCHAR(255),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_magnet_orders_status ON magnet_orders(status);
CREATE INDEX idx_magnet_orders_household ON magnet_orders(household_id);
CREATE INDEX idx_magnet_orders_created ON magnet_orders(created_at);
```

Valid status values:
- new
- paid
- in_production
- shipped
- delivered
- activated
- canceled
- refunded

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… SUCCESS CRITERIA

Implementation successful when:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… GET /api/admin/magnets returns 200 with JSON
âœ… Dashboard loads without "Unexpected token" error
âœ… Metrics cards show correct data
âœ… Orders table displays all magnet orders
âœ… Filters work (search, status, date range)
âœ… Authentication required (401 without token)
âœ… Admin authorization required (403 for non-admin)
âœ… No console errors
âœ… Can view order details
âœ… Can update order status

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ IMPLEMENTATION NOTES

Time Estimate:
â€¢ Backend endpoint: 30 minutes
â€¢ Route registration: 5 minutes
â€¢ Frontend fix: 15 minutes
â€¢ Testing: 10 minutes
â€¢ Total: ~1 hour

Dependencies:
â€¢ requireAdmin middleware (should already exist)
â€¢ JWT authentication (should already be set up)
â€¢ magnet_orders table in database
â€¢ Admin token in localStorage

Files to Create:
âœ… server/src/routes/admin/magnets.ts (NEW)

Files to Modify:
âœ… server/src/routes/index.ts (add route registration)
âœ… client/src/pages/admin/MagnetOrders.tsx (fix API call)

No Database Changes Required:
â€¢ Uses existing magnet_orders table
â€¢ No schema migrations needed

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ KEY LEARNINGS

Why "Unexpected token '<'" Error Occurs:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
When API endpoint doesn't exist:
1. Frontend calls /api/admin/magnets
2. Backend doesn't have this route
3. Server returns 404 HTML error page
4. Frontend tries to parse HTML as JSON
5. Error: "Unexpected token '<'" (from <!DOCTYPE html>)

Solution:
Create the endpoint that returns proper JSON

How to Prevent:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Always check content-type before parsing
âœ… Handle HTTP errors before parsing JSON
âœ… Log response status and content-type
âœ… Return JSON errors from backend (not HTML)
âœ… Use proper error handling in frontend

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… READY FOR IMPLEMENTATION

This specification is complete and ready for Replit Agent to implement.

All code examples are production-ready.
All edge cases are handled.
All testing steps are documented.

Estimated implementation time: 1 hour

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

END OF REPLIT AGENT SPECIFICATION