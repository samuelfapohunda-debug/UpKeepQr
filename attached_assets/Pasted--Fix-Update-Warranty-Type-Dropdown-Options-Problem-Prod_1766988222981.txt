# Fix: Update Warranty Type Dropdown Options

## Problem
Production has incorrect warranty type options:
- ❌ "Store Protection Plan" 
- ❌ "Home Warranty"

Dev environment has correct options:
- ✅ "Manufacturer"
- ✅ "Extended" 
- ✅ "Labor"

## Solution: Update the Warranty Type Options

### Updated Component Code

Add these constants and update the form in `HouseholdAppliancesView.tsx`:

```typescript
// Add this constant near the top with APPLIANCE_TYPES
const WARRANTY_TYPES = [
  "Manufacturer",
  "Extended",
  "Labor",
];

// Update the interface to include warrantyType
interface ApplianceFormData {
  applianceType: string;
  brand: string;
  modelNumber: string;
  serialNumber: string;
  purchaseDate: string;
  installationDate: string;
  warrantyExpirationDate: string;
  warrantyType: string;           // ADD THIS
  warrantyProvider: string;       // ADD THIS
  warrantyTerms: string;          // ADD THIS
  purchasePrice: string;
  locationInHome: string;
  notes: string;
}

// Update emptyFormData
const emptyFormData: ApplianceFormData = {
  applianceType: "",
  brand: "",
  modelNumber: "",
  serialNumber: "",
  purchaseDate: "",
  installationDate: "",
  warrantyExpirationDate: "",
  warrantyType: "",               // ADD THIS
  warrantyProvider: "",           // ADD THIS
  warrantyTerms: "",              // ADD THIS
  purchasePrice: "",
  locationInHome: "",
  notes: "",
};
```

### Add Warranty Section to Form

In the form dialog, add this warranty section AFTER the dates section:

```typescript
{/* Warranty Information Section */}
<div className="space-y-4 pt-4 border-t">
  <h4 className="font-medium">Warranty Information</h4>
  
  <div className="grid grid-cols-2 gap-4">
    {/* Warranty Expiration Date */}
    <div className="space-y-2">
      <Label htmlFor="warrantyExpirationDate">
        Warranty Expiration
      </Label>
      <Input
        id="warrantyExpirationDate"
        type="date"
        value={formData.warrantyExpirationDate}
        onChange={(e) =>
          setFormData({
            ...formData,
            warrantyExpirationDate: e.target.value,
          })
        }
      />
    </div>

    {/* Warranty Type */}
    <div className="space-y-2">
      <Label htmlFor="warrantyType">Warranty Type</Label>
      <Select
        value={formData.warrantyType}
        onValueChange={(value) =>
          setFormData({ ...formData, warrantyType: value })
        }
      >
        <SelectTrigger>
          <SelectValue placeholder="Select warranty type" />
        </SelectTrigger>
        <SelectContent>
          {WARRANTY_TYPES.map((type) => (
            <SelectItem key={type} value={type}>
              {type}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>
    </div>
  </div>

  {/* Warranty Provider */}
  <div className="space-y-2">
    <Label htmlFor="warrantyProvider">Warranty Provider</Label>
    <Input
      id="warrantyProvider"
      value={formData.warrantyProvider}
      onChange={(e) =>
        setFormData({ ...formData, warrantyProvider: e.target.value })
      }
      placeholder="e.g., Samsung, Asurion"
    />
  </div>

  {/* Coverage Details */}
  <div className="space-y-2">
    <Label htmlFor="warrantyTerms">Coverage Details</Label>
    <Textarea
      id="warrantyTerms"
      value={formData.warrantyTerms}
      onChange={(e) =>
        setFormData({ ...formData, warrantyTerms: e.target.value })
      }
      placeholder="What does the warranty cover?"
      rows={2}
    />
  </div>
</div>
```

### Update the handleEditAppliance function

```typescript
const handleEditAppliance = (appliance: HouseholdAppliance) => {
  setEditingAppliance(appliance);
  setFormData({
    applianceType: appliance.applianceType || "",
    brand: appliance.brand || "",
    modelNumber: appliance.modelNumber || "",
    serialNumber: appliance.serialNumber || "",
    purchaseDate: appliance.purchaseDate
      ? new Date(appliance.purchaseDate).toISOString().split("T")[0]
      : "",
    installationDate: appliance.installationDate
      ? new Date(appliance.installationDate).toISOString().split("T")[0]
      : "",
    warrantyExpirationDate: appliance.warrantyExpirationDate
      ? new Date(appliance.warrantyExpirationDate).toISOString().split("T")[0]
      : "",
    warrantyType: appliance.warrantyType || "",              // ADD THIS
    warrantyProvider: appliance.warrantyProvider || "",      // ADD THIS
    warrantyTerms: appliance.warrantyTerms || "",            // ADD THIS
    purchasePrice: appliance.purchasePrice || "",
    locationInHome: appliance.locationInHome || "",
    notes: appliance.notes || "",
  });
  setIsDialogOpen(true);
};
```

### Update Backend API to Handle Warranty Fields

Update `server/src/routes/appliances.ts`:

```typescript
// In POST endpoint, add these fields to the values:
const [newAppliance] = await db
  .insert(householdAppliances)
  .values({
    id: applianceId,
    householdId,
    applianceType,
    brand: brand || null,
    modelNumber: modelNumber || null,
    serialNumber: serialNumber || null,
    purchaseDate: purchaseDate ? new Date(purchaseDate) : null,
    installationDate: installationDate ? new Date(installationDate) : null,
    warrantyExpirationDate: warrantyExpirationDate
      ? new Date(warrantyExpirationDate)
      : null,
    warrantyType: warrantyType || null,           // ADD THIS
    warrantyProvider: warrantyProvider || null,   // ADD THIS
    warrantyTerms: warrantyTerms || null,         // ADD THIS
    purchasePrice: purchasePrice || null,
    locationInHome: locationInHome || null,
    notes: notes || null,
    createdAt: new Date(),
    updatedAt: new Date(),
  })
  .returning();

// In PUT endpoint, add these fields to the set:
const [updatedAppliance] = await db
  .update(householdAppliances)
  .set({
    applianceType,
    brand: brand || null,
    modelNumber: modelNumber || null,
    serialNumber: serialNumber || null,
    purchaseDate: purchaseDate ? new Date(purchaseDate) : null,
    installationDate: installationDate ? new Date(installationDate) : null,
    warrantyExpirationDate: warrantyExpirationDate
      ? new Date(warrantyExpirationDate)
      : null,
    warrantyType: warrantyType || null,           // ADD THIS
    warrantyProvider: warrantyProvider || null,   // ADD THIS
    warrantyTerms: warrantyTerms || null,         // ADD THIS
    purchasePrice: purchasePrice || null,
    locationInHome: locationInHome || null,
    notes: notes || null,
    updatedAt: new Date(),
  })
  .where(
    and(
      eq(householdAppliances.id, applianceId),
      eq(householdAppliances.householdId, householdId)
    )
  )
  .returning();

// Update the destructuring at the top of both POST and PUT:
const {
  applianceType,
  brand,
  modelNumber,
  serialNumber,
  purchaseDate,
  installationDate,
  warrantyExpirationDate,
  warrantyType,        // ADD THIS
  warrantyProvider,    // ADD THIS
  warrantyTerms,       // ADD THIS
  purchasePrice,
  locationInHome,
  notes,
} = req.body;
```

## Complete Updated Form Layout

The form should have these sections in this order:

1. **Basic Information**
   - Appliance Type* (dropdown)
   - Brand (text)
   - Model Number (text)

2. **Identification**
   - Serial Number (text)
   - Location in Home (text)

3. **Purchase Information**
   - Purchase Date (date)
   - Installation Date (date)
   - Purchase Price ($)

4. **Warranty Information** ⭐ NEW SECTION
   - Warranty Expiration (date)
   - Warranty Type (dropdown: Manufacturer, Extended, Labor)
   - Warranty Provider (text: e.g., Samsung, Asurion)
   - Coverage Details (textarea)

5. **Additional Notes**
   - Notes (textarea)

## Deploy Commands

```bash
# Stage changes
git add client/src/components/HouseholdAppliancesView.tsx
git add server/src/routes/appliances.ts

# Commit
git commit -m "fix: Update warranty type options to Manufacturer/Extended/Labor

- Replace Store Protection Plan/Home Warranty with proper warranty types
- Add warranty provider and coverage details fields
- Update backend to handle new warranty fields
- Add warranty information section to form
- Match dev environment warranty type options"

# Push to production
git push origin main
```

## Verify After Deployment

1. Wait 3 minutes for deployment
2. Hard refresh: Ctrl+Shift+R
3. Go to https://upkeepqr.com/admin/setup-forms
4. Click household > Appliances > Add Appliance
5. Scroll to "Warranty Information" section
6. Click "Warranty Type" dropdown
7. Should see: **Manufacturer, Extended, Labor** ✅
8. Fill form and submit - should work! ✅

## Test Case

**Add Test Appliance:**
- Type: Refrigerator
- Brand: Samsung
- Model: RF28R7351SR
- Warranty Expiration: 2026-12-31
- **Warranty Type: Extended** ⭐
- **Warranty Provider: Asurion** ⭐
- **Coverage: Parts and labor** ⭐
- Location: Kitchen
- Price: 1299.99

This should submit successfully with all warranty fields! ✅

## Benefits of This Approach

✅ Keeps useful warranty tracking features
✅ Matches your dev environment exactly
✅ Uses proper warranty terminology
✅ Allows tracking warranty provider (Samsung vs Asurion, etc.)
✅ Captures coverage details for reference
✅ Better data for warranty expiration alerts

## Database Schema Support

The `household_appliances` table already has these fields:
- `warranty_expiration_date` ✅
- `warranty_type` ✅ (we're using this now!)
- `warranty_provider` ✅ (we're using this now!)
- `warranty_terms` ✅ (we're using this now!)
- `is_under_warranty` (can be auto-calculated based on expiration)

So this is using the existing database schema properly!